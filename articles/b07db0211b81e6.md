---
title: "Dockerコンテナ内のMysqlのバックアップをホストのCronで取る方法"
emoji: "🐳"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Docker","Mysql","バックアップ"]
published: false
---

# はじめに
最近Dockerを使い始めました。
想像していたよりも、簡単に環境が構築できて、なぜ今まで使わなかったか不思議です。
さて、そんな感じでDockerは便利なのですが、タイトルにもあるようにDockerコンテナ内のMysqlの定期バックアップのやり方の情報がネット上に少なくて苦労したので、備忘録がてらここにのしておこうと思います。


# バックアップをするシェルスクリプト(bash)
### コード
```bash
#!/bin/bash

YEAR=`date '+%Y'`
MONTH=`date '+%m'`
DATE=`date '+%Y%m%d'`

SCRIPT_DIR=$(cd $(dirname $0); pwd)
#echo $SCRIPT_DIR
mkdir -p ${SCRIPT_DIR}/${YEAR}/${MONTH}
#/usr/bin/docker exec -i mysql /usr/bin/mysqldump -uroot -proot keiba > ${SCRIPT_DIR}/${YEAR}/${MONTH}/backup${DATE}.sql
/usr/bin/docker exec -i mysql /usr/bin/mysqldump -uroot -proot keiba | gzip > ${SCRIPT_DIR}/${YEAR}/${MONTH}/backup${DATE}.sql.gz
```

上記シェルスクリプトは指定したデータベースのフルバックアップするものです

###  試しにcronで2日動かした結果
```
<任意のフォルダ名>
├── 2022
│   └── 09
│       ├── backup20220922.sql.gz
│       └── backup20220923.sql.gz
└── backup.sh
```
しっかり出力されてますね。
こんな感じでシェルスクリプトと同じ階層に年ディレクトリが作成され、さらその中に月ディレクトリが作成され、その中に年、月、日付の圧縮されたsqlファイルが保存されます。

# まとめ
今回は雑に、毎日フルバックアップを取る形にしましたが、差分バックアップを取る方が良い場合もあると思いますので、今後勉強していこうと思ってます。

# 参考記事
  https://mi-rai.co.jp/blog/6566